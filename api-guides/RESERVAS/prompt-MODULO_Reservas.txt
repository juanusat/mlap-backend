--- INSTRUCCIONES DE GENERACIÓN DE API (Gestionar Reservas Pendientes - Cliente) ---
Para: routes_private_reservas_ReservasPendentes.yaml

OBJETIVO:
Generar la especificación completa de las rutas (endpoints) del Módulo 'Reservas' (Cliente) - Submódulo 'Reservas Pendientes', que permite al usuario visualizar y cancelar sus reservas activas. Basado en las imágenes (Listado y Confirmar eliminación).

JERARQUÍA DE MÓDULOS REQUERIDA:
La ruta base para este módulo debe ser: /api/client/reservations

REGLAS DE ENDPOINTS:
1.  **Obtener/Ver:** /{ruta}/{id} [GET]
2.  **Actualizar (Total):** /{ruta}/{id} [PUT]
3.  **Actualizar (Parcial/Lógica):** /{ruta}/{id} [PATCH] (Usar para baja lógica de 'Estado' o 'Eliminar').
4.  **Crear:** /{ruta}/create [POST]
5.  **Listar (Paginado):** /{ruta}/list [POST]
6.  **Buscar (Paginado/Filtrado):** /{ruta}/search [POST]
7.  Los métodos GET no tienen body de entrada, solo parámetros de ruta o query.

REGLAS DE FORMATO DE RESPUESTA (OBLIGATORIO):
Todas las respuestas DEBEN seguir este formato JSON:
{
  "message": "string",
  "data": {}, // Array para list/search, Objeto para create/get/update
  "error": "string o null",
  "traceback": "string o null"
}

--- DATOS DE CONTEXTO DE LA PANTALLA ---

MÓDULO: Reservas (Cliente)
SUBMÓDULO: Reservas Pendientes
TABLA PRINCIPAL: reservation
ESTADOS INCLUIDOS: 'RESERVED', 'IN_PROGRESS'.
FUNCIONALIDADES DE LA UI (CRUD):

1.  **Listado/Búsqueda (Listar/Buscar):** Pantalla principal. Muestra ID, Evento (Variant Name), Fecha (Date), Monto, Estado.
    * Necesita paginación y búsqueda por texto (en el campo Evento).
    * Solo muestra reservas asociadas al usuario logueado.

2.  **Cancelar Reserva (Baja Lógica):** Botón "Tacho de basura" en la tabla, que abre el modal "Confirmar eliminación".
    * Cambia el estado de la reserva a 'CANCELLED'.
    * Debe registrarse en `event_audit_log`.

--- TAREAS DE GENERACIÓN ---

Generar las especificaciones de los siguientes endpoints con sus cuerpos de entrada y salida (datos) detallados. Para la cancelación, se usará un `PATCH` a la ruta anidada para especificar la acción de cambio de estado.

1.  /api/client/reservations/search [POST] (Incluye Listado y Búsqueda)
2.  /api/client/reservations/{id}/cancel [PATCH] (Para la cancelación lógica)

--- ESPECIFICACIÓN DE ENDPOINTS ---

# 1. Buscar/Listar Reservas Pendientes del Usuario Logueado
# /api/client/reservations/search [POST]
# OBJETIVO: Obtener un listado paginado y filtrado de las reservas activas ('RESERVED', 'IN_PROGRESS') de la persona asociada al usuario logueado.

RUTA: /api/client/reservations/search [POST]
PERMISOS REQUERIDOS: JWT (Autenticación de usuario)

ENTRADA (Body):
```json
{
  "page": 1, 
  "limit": 10,
  "search_term": "matrimonio" // Opcional. Búsqueda por EventVariant.name
}


---------------------------------------------------------------------
--- INSTRUCCIONES DE GENERACIÓN DE API (Historial de Reservas - Cliente) ---
Para: routes_private_reservas_HistorialReservas.yaml

OBJETIVO:
Generar la especificación completa de las rutas (endpoints) del Módulo 'Reservas' (Cliente) - Submódulo 'Historial de Reservas', que permite al usuario visualizar sus reservas concluidas o canceladas, y ver sus detalles (incluyendo requisitos). Basado en las imágenes (Listado y Detalles).

JERARQUÍA DE MÓDULOS REQUERIDA:
La ruta base para este módulo debe ser: /api/client/reservations

REGLAS DE ENDPOINTS:
1.  **Obtener/Ver:** /{ruta}/{id} [GET]
2.  **Actualizar (Total):** /{ruta}/{id} [PUT]
3.  **Actualizar (Parcial/Lógica):** /{ruta}/{id} [PATCH] (Usar para baja lógica de 'Estado' o 'Eliminar').
4.  **Crear:** /{ruta}/create [POST]
5.  **Listar (Paginado):** /{ruta}/list [POST]
6.  **Buscar (Paginado/Filtrado):** /{ruta}/search [POST]
7.  Los métodos GET no tienen body de entrada, solo parámetros de ruta o query.

REGLAS DE FORMATO DE RESPUESTA (OBLIGATORIO):
Todas las respuestas DEBEN seguir este formato JSON:
{
  "message": "string",
  "data": {}, // Array para list/search, Objeto para create/get/update
  "error": "string o null",
  "traceback": "string o null"
}

--- DATOS DE CONTEXTO DE LA PANTALLA ---

MÓDULO: Reservas (Cliente)
SUBMÓDULO: Historial de Reservas
TABLA PRINCIPAL: reservation
ESTADOS INCLUIDOS: 'COMPLETED', 'FULFILLED', 'CANCELLED', 'REJECTED'.
FUNCIONALIDADES DE LA UI (CRUD):

1.  **Listado/Búsqueda (Listar/Buscar):** Pantalla principal. Muestra ID, Evento (Variant Name), Fecha (Date), Monto, Estado.
    * Necesita paginación y búsqueda por texto (en el campo Evento).
    * Solo muestra reservas asociadas al usuario logueado.

2.  **Detalles (Ver):** Botón "ojo" en la tabla, que abre el modal "Detalles de la Reserva #X".
    * Muestra información de la reserva, el estado del pago (asumido como campo derivado/lógico) y el listado de requisitos (`reservation_requirement`) con su estado de completado.

--- TAREAS DE GENERACIÓN ---

Generar las especificaciones de los siguientes endpoints con sus cuerpos de entrada y salida (datos) detallados:

1.  /api/client/reservations/history/search [POST] (Incluye Listado y Búsqueda del historial)
2.  /api/client/reservations/{id} [GET] (Para obtener los detalles de la reserva)

--- ESPECIFICACIÓN DE ENDPOINTS ---

# 1. Buscar/Listar Historial de Reservas del Usuario Logueado
# /api/client/reservations/history/search [POST]
# OBJETIVO: Obtener un listado paginado y filtrado de las reservas concluidas o canceladas ('COMPLETED', 'FULFILLED', 'CANCELLED', 'REJECTED') de la persona asociada al usuario logueado. Se utiliza una sub-ruta `/history` para diferenciarlo de las reservas pendientes.

RUTA: /api/client/reservations/history/search [POST]
PERMISOS REQUERIDOS: JWT (Autenticación de usuario)

ENTRADA (Body):
```json
{
  "page": 1, 
  "limit": 10,
  "search_term": "unción", // Opcional. Búsqueda por EventVariant.name
  "status": "REJECTED" // Opcional. Filtro por estado ('COMPLETED' | 'FULFILLED' | 'CANCELLED' | 'REJECTED')
}

---------------------------------------------------------------------
--- INSTRUCCIONES DE GENERACIÓN DE API (Reservar Evento - Cliente) ---
Para: routes_private_reservas_ReservarEvento.yaml
---

OBJETIVO:
Generar la especificación completa de las rutas (endpoints) del Módulo 'Reservas' (Cliente) - Submódulo 'Reservar Evento', que permite al usuario finalizar el proceso de selección y crear una nueva reserva. Basado en la imagen de la interfaz final.

JERARQUÍA DE MÓDULOS REQUERIDA:
La ruta base para este módulo debe ser: /api/client/reservations

REGLAS DE ENDPOINTS:
1.  **Obtener/Ver:** /{ruta}/{id} [GET]
2.  **Actualizar (Total):** /{ruta}/{id} [PUT]
3.  **Actualizar (Parcial/Lógica):** /{ruta}/{id} [PATCH]
4.  **Crear:** /{ruta}/create [POST]
5.  **Listar (Paginado):** /{ruta}/list [POST]
6.  **Buscar (Paginado/Filtrado):** /{ruta}/search [POST]
7.  Los métodos GET no tienen body de entrada, solo parámetros de ruta o query.

REGLAS DE FORMATO DE RESPUESTA (OBLIGATORIO):
Todas las respuestas DEBEN seguir este formato JSON:
{
  "message": "string",
  "data": {}, // Array para list/search, Objeto para create/get/update
  "error": "string o null",
  "traceback": "string o null"
}

--- DATOS DE CONTEXTO DE LA PANTALLA ---

MÓDULO: Reservas (Cliente)
SUBMÓDULO: Reservar Evento
TABLAS PRINCIPALES: reservation, reservation_requirement
FUNCIONALIDADES DE LA UI (CRUD):

1.  **Validación de Disponibilidad (Auxiliar):** El formulario de fecha/hora requiere verificar que el horario seleccionado esté disponible, cumpliendo con las reglas de `general_schedule`, `specific_schedule` y que no exceda la capacidad (`max_capacity`) en `reservation`.

2.  **Creación de Reserva (Aceptar):** Botón "Aceptar". Registra la reserva, asocia a la persona logueada y copia todos los requisitos activos (base y de capilla) a `reservation_requirement`.

--- TAREAS DE GENERACIÓN ---

Generar las especificaciones de los siguientes endpoints con sus cuerpos de entrada y salida (datos) detallados:

1.  /api/client/reservations/availability [POST] (API Auxiliar para obtener horarios disponibles)
2.  /api/client/reservations/create [POST] (API Principal para crear la reserva)

--- ESPECIFICACIÓN DE ENDPOINTS ---

# 1. Obtener Disponibilidad de Horario
# /api/client/reservations/availability [POST]
# OBJETIVO: Verificar qué fechas/horas están disponibles para una EventVariant específica, considerando horarios de capilla y reservas existentes.

RUTA: /api/client/reservations/availability [POST]
PERMISOS REQUERIDOS: JWT (Autenticación de usuario) o N/A (Puede ser público si solo valida disponibilidad)

ENTRADA (Body):
```json
{
  "event_variant_id": 15, // ID de la variante de evento seleccionada
  "start_date": "2025-09-01", // Rango de inicio para la consulta (YYYY-MM-DD)
  "end_date": "2025-09-30" // Rango de fin para la consulta (YYYY-MM-DD)
}